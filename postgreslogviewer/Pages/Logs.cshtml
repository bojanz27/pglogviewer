@page
@model postgreslogviewer.Pages.LogsModel
@{
}

<div style="margin-left:2px;">
    <form method="post">

        <div class="accordion" id="accordionExample" style="margin-bottom:15px">
            <div class="card">
                <div class="card-header" id="headingOne">
                    <div>
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Filter
                        </button>
                    </div>
                </div>

                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                    <div class="card-body">

                        <div class="form-group row">
                            <div class="col-4">
                                <label asp-for="PathToCsvLogFile" style="color:#aaa" class="col-form-label display-3">Log file</label>
                                <input asp-for="PathToCsvLogFile" class="form-control" type="text" placeholder="Csv log file full path">
                            </div>

                            <div class="col-sm-1">
                                <label asp-for="RowsPerPage" style="color:#aaa" class="col-form-label display-3">Rows per page</label>
                                <input asp-for="RowsPerPage" class="form-control" type="number">
                            </div>

                        </div>
                        <div class="form-group row">
                            <div class="col-4">
                                <label asp-for="DbNames" style="color:#aaa" class="col-form-label display-3">Show only databases</label>
                                <input asp-for="DbNames" class="form-control" type="text" placeholder="Database names, comma-separated">
                            </div>
                            <div class="col-4">
                                <label asp-for="ExcludeContaining" style="color:#aaa" class="col-form-label display-3">Exclude where query contains</label>
                                <input asp-for="ExcludeContaining" class="form-control" type="text" placeholder="Text to search in query">
                            </div>
                            <div style="margin-top:auto">
                                <button class="btn btn-primary form-control" type="submit">Refresh</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>
<div class="card">
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-sm table-active table-dark resultsTable" style="font-family: Consolas;">

            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">LOG TIME</th>
                    <th scope="col">USERNAME</th>
                    <th scope="col">DATABASE</th>
                    <th scope="col">QUERY</th>
                </tr>
            </thead>

            <tbody style="font-size:12px; font-family:Consolas">
                @foreach (var log in Model.LogEntries)
                {
                    <tr>
                        <th scope="col">@log.RowNumber</th>
                        <td scope="col" style="white-space: nowrap;">@log.A_TimeStamp</td>
                        <td scope="col">@log.B_User</td>
                        <td scope="col">@log.C_Database</td>

                        <th scope="col">
                            <pre style="max-width:999px; white-space:pre-wrap;"><code style="background-color: #272B30" class="pgsql"> @log.N_Statement </code></pre>
                            @if (!string.IsNullOrEmpty(log.O_Parameters))
                            {

                                <pre style="max-width:999px; white-space:pre-wrap;"><code style="background-color: #272B30" class="pgsql"> @log.O_Parameters </code></pre>

                            }
                        </th>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
